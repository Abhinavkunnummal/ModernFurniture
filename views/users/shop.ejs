<%- include('../layouts/header.ejs') %>

<%- include('../layouts/navbar.ejs') %>


<!-- Sorting Options -->
<div class="container mt-3">
    <div class="row">
        <div class="col-md-6">
           <!-- Sorting Options -->
		   <select class="form-select" id="sortingOptions">
			<option value="priceLowToHigh">Price: Low to High</option>
			<option value="priceHighToLow">Price: High to Low</option>
			<!-- <option value="averageRatings">Average Ratings</option> -->
			<!-- <option value="featured">Featured</option> -->
			<option value="newArrivals">New Arrivals</option>
			<!-- <option value="nameAZ">Name: A-Z</option>
			<option value="nameZA">Name: Z-A</option> -->
		  </select>
        </div>
    </div>
</div>

<!-- Product Listing -->
<div class="untree_co-section product-section before-footer-section">
    <div class="container">
        <div class="row" id="productList">
            <% products.forEach(product => { %>
            <!-- Start Column 1 -->
            <div class="col-12 col-md-4 col-lg-4 mb-5">
                <a class="product-item" href='/productFull?id=<%= product._id %>'>
                    <img src="/productimage/<%= product.image[0] %>" class="img-fluid product-thumbnail">
                    <h3 class="product-title"><%= product.name %></h3>
                    <strong class="product-price"><%= product.price %></strong>
                    <span class="icon-cross">
                        <img src="assets/images/cross.svg" class="img-fluid">
                    </span>
                </a>
            </div>
            <!-- End Column 1 -->
            <% }) %>
        </div>
    </div>
</div>

<%- include('../layouts/footer.ejs') %>


<script>
	document.getElementById('sortingOptions').addEventListener('change', function () {
	  var sortingCriteria = this.value;
	  fetch(`/sortProducts?sort=${sortingCriteria}`)
		.then(response => response.json())
		.then(data => {
		  renderProducts(data.products);
		})
		.catch(error => console.error('Error fetching and sorting products:', error));
	});
  
	function renderProducts(products) {
	  var productList = document.getElementById('productList');
	  productList.innerHTML = ''; // Clear existing products
  
	  products.forEach(product => {
		var productItem = `
		  <div class="col-12 col-md-4 col-lg-4 mb-5">
			<a class="product-item" href='/productFull?id=${product._id}'>
			  <img src="/productimage/${product.image[0]}" class="img-fluid product-thumbnail">
			  <h3 class="product-title">${product.name}</h3>
			  <strong class="product-price">${product.price}</strong>
			  <span class="icon-cross">
				<img src="assets/images/cross.svg" class="img-fluid">
			  </span>
			</a>
		  </div>
		`;
		productList.insertAdjacentHTML('beforeend', productItem);
	  });
	}
  </script>